{% load staticfiles %}
<h1>geodjango tests</h1>

<form method="post" action="./">
    {% csrf_token %}
    <table>
        {{ form }}
    </table>
    <input type="submit" value="Search" />
</form>

{% if shops %}
<h2>Shops near you</h2>
<ul>
    {% for shop in shops %}
    <li><b>{{ shop.name }}</b>: distance: {{ shop.distance }}</li>
    {% endfor %}
</ul>

<script type="text/javascript" src="//maps.google.com/maps/api/js?sensor=false"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        var latlng = new google.maps.LatLng("{{ latitude }}", "{{ longitude }}");
        var mapOptions = {
            zoom: 11,
            center: latlng,
            mapTypeControl: false,
            navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map($('.map')[0], mapOptions);
    
        var marker = new google.maps.Marker({
            position: latlng,
            map: map,
            title:"Your address"
        });
        
        {% for shop in shops %}
            var contentString = '<div id="content">' +
                '<div id="siteNotice"></div>' +
                '<h1 id="firstHeading" class="firstHeading">{{ shop }}</h1>' +
                '<div id="bodyContent">' + 
                '<p>The shop description</p>' + 
                '<p><img src="{% static "shops/strawberry-icon.png" %}" /></p>' +
                '</div>' +
                '</div>';
            var infoWindow = new google.maps.InfoWindow({
                content: contentString,
            });
            
            latlng = new google.maps.LatLng("{{ shop.location.y }}", "{{ shop.location.x }}");
            var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                title:"{{ shop.name }}",
		icon: "{% static "shops/farm-2.png" %}",
            });
            google.maps.event.addListener(marker, 'click', function() {
                infoWindow.open(map, marker);
            });

        {% endfor %}
    });
</script>
<div class="map" style="width: 400px; height: 400px;"></div>
{% endif %}
